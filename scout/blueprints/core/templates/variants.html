{% extends 'layouts/scroll-header.html' %}
{% from '_macros.html' import compounds_table %}

{% set page_title = case.display_name ~ '- Variants' %}
{% if case.is_solved %}
  {% set header_classes = 'success' %}
{% elif case.is_archived %}
  {% set header_classes = 'disabled' %}
{% endif %}

{% block toolbar_right %}
  {{ super() }}

  <div v-on:click="showRightDrawer" class="icon-button">
    <core-icon icon="filter-list"></core-icon>
  </div>
{% endblock %}

{% block toolbar_custom %}
  <div class="variants-header">

    <div class="variants-header-item flex-small" title="Rank position">Rank</div>
    <div class="variants-header-item flex-small" title="Rank score">Score</div>
    <div class="variants-header-item flex-small" title="Chromosome">Chr.</div>
    <div class="variants-header-item" title="HGNC">Gene</div>
    <div class="variants-header-item" title="1000 Genomes">1000G</div>
    <div class="variants-header-item flex-small" title="CADD score">CADD</div>
    <div class="variants-header-item" title="Gene annotation">
      Gene annotation
    </div>
    <div class="variants-header-item flex-big" title="Func. annotation">
      Func. annotation
    </div>
    {% if variant_type == 'clinical' %}
      <div class="variants-header-item" title="Disease gene model">
        Expected inheritance
      </div>
    {% endif %}
    <div class="variants-header-item flex-big" title="Inheritance models">
      Inheritance models
    </div>

  </div>
{% endblock %}

{% block content %}

  <drawer-panel :visible="drawerRightVisible" v-on:hide="hideRightDrawer" side="right">
    <form method="POST" action="{{ url_for('core.upload_gene_list') }}"
          enctype="multipart/form-data">
      <div class="variants-filters-group">
        <div class="variants-filters-group-list">
          <div class="variants-filters-group-label">
            {{ upload_form.gene_list.label }}
          </div>
          <div class="list-item">
            <div>{{ upload_form.gene_list(class='full-width') }}</div>
            <div><button type="submit">Upload</button></div>
          </div>
        </div>
      </div>
    </form>

    <form method="GET">
      {{ form.csrf_token }}

      <div class="variants-filter-buttons">
        <a href="{{ url_for('core.variants', institute_id=institute_id,
                      case_id=case_id,
                      variant_type=variant_type,
                      functional_annotations=severe_so_terms,
                      region_annotations=['exonic', 'splicing'],
                      thousand_genomes_frequency=institute.frequency_cutoff,
                      gene_lists=current_gene_lists,
                      hgnc_symbols=form.hgnc_symbols.data) }}"
           class="md-button">
          Clinical filter
        </a>

        <button class="md-button" type="submit">
          Filter variants
        </button>
      </div>

      <div class="variants-filters-group">
        <div class="variants-filters-group-label">
          {{ form.gene_lists.label }}
        </div>

        <div class="variants-filters-group-list">
          {{ form.gene_lists(class="variants-filters-select") }}

          <div class="list-item">
            <a class="md-button"
               href="{{ url_for('core.variants',
                             institute_id=institute_id,
                             case_id=case_id,
                             variant_type=variant_type,
                             gene_lists=['hpo']) }}">
              HPO generated gene list
            </a>
          </div>
        </div>
      </div>

      <div class="variants-filters-group">
        <div class="variants-filters-group-label">Filters</div>

        <div class="variants-filters-group-list">
          <div class="list-item">
            <div>{{ form.hgnc_symbols.label }}</div>
            <div>{{ form.hgnc_symbols }}</div>
          </div>

          <div class="list-item">
            <div>{{ form.cadd_score.label }}</div>
            <div>{{ form.cadd_score }}</div>
          </div>

          <div class="list-item">
            <div>{{ form.cadd_inclusive.label }}</div>
            <div>{{ form.cadd_inclusive }}</div>
          </div>

          <div class="list-item">
            <div>{{ form.clinsig.label }}</div>
            <div>{{ form.clinsig }}</div>
          </div>
        </div>
      </div>

      <div class="variants-filters-group">
        <div class="variants-filters-group-label">Frequency cutoffs</div>

        <div class="variants-filters-group-list">
          <div class="list-item">
            <div>{{ form.thousand_genomes_frequency.label }}</div>
            <div>{{ form.thousand_genomes_frequency(type='number') }}</div>
          </div>

          <div class="list-item">
            <div>{{ form.exac_frequency.label }}</div>
            <div>{{ form.exac_frequency }}</div>
          </div>
        </div>
      </div>

      <div class="variants-filters-group">
        <div class="variants-filters-group-label">
          {{ form.region_annotations.label }}
        </div>

        <div class="variant-filters-group-body">
          {{ form.region_annotations(class="variants-filters-select") }}
        </div>
      </div>

      <div class="variants-filters-group">
        <div class="variants-filters-group-label">
          {{ form.functional_annotations.label }}
        </div>

        <div class="variant-filters-group-body">
          {{ form.functional_annotations(class="variants-filters-select") }}
        </div>
      </div>

      <div class="variants-filters-group">
        <div class="variants-filters-group-label">
          {{ form.genetic_models.label }}
        </div>

        <div class="variant-filters-group-body ">
          {{ form.genetic_models(class="variants-filters-select") }}
        </div>
      </div>
    </form>
  </drawer-panel>

{% endblock %}
