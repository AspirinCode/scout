{% macro comments_panel(institute, case, current_user, comments, variant_id=None) %}
  <div class="panel panel-default">
    <div class="panel-heading">Comments</div>
    <ul class="list-group">
      {% for comment in comments %}
        <li class="list-group-item">
          <div class="row">
            <div class="col-xs-12">{{ comment.content }}</div>
          </div>
          <div class="row">
            <div class="col-xs-12">
              <form method="POST"
                    action="{{ url_for('api.delete_event',
                                       institute_id=institute.internal_id,
                                       case_id=case.display_name,
                                       event_id=comment.id) }}">
                <small>
                  <br>
                  <strong>{{ comment.author.name }}</strong>
                  on {{ comment.created_at.date() }}
                  {% if comment.level == 'global' %}
                    <span class="label label-info">GLOBAL</span>
                  {% endif %}
                  {% if comment.created_at < case.updated_at %}
                    <span class="label label-warning">OLD</span>
                  {% endif %}
                </small>
                {% if comment.author.id == current_user.id %}
                  <div class="pull-right">
                    <button class="btn btn-link btn-sm no-padding" type="submit">
                      <span class="glyphicon glyphicon-remove"></span>
                    </button>
                  </div>
                {% endif %}
              </form>
            </div>
          </div>
        </li>
      {% else %}
        <li class="list-group-item">No case comments yet</li>
      {% endfor %}
    </ul>
    <div class="panel-footer">
      <form action="{{ url_for('api.create_event', institute_id=institute.internal_id, case_id=case.display_name, variant_id=variant_id) }}" method="POST">
        <input type="hidden" name="link" value="{{ url_for('core.variant', institute_id=institute_id, case_id=case_id, variant_id=variant_id) if variant_id else url_for('core.case', institute_id=institute.internal_id, case_id=case.display_name) }}">
        <div class="form-group">
          <textarea class="form-control" name="content" placeholder="Leave a comment"></textarea>
        </div>
        <div class="row">
          {% if variant_id %}
            <div class="col-xs-6">
              <div class="checkbox">
                <label>
                  <input type="checkbox" name="level" value="global">
                  Comment globally
                </label>
              </div>
            </div>
          {% endif %}
          <div class="col-xs-{{ 6 if variant_id else 12 }}">
            <button class="btn btn-default form-control" type="submit">Comment</button>
          </div>
        </div>
      </form>
    </div>
  </div>
{% endmacro %}

{% macro compounds_table(institute_id, case_id, compounds) %}
  <table class='table table-bordered table-hover table-condensed'>
    <thead>
      <tr>
        <th>Variant</th>
        <th>Combined score</th>
        <th>Rank score</th>
        <th>Gene annotation</th>
        <th>Func. annotation</th>
      </tr>
    </thead>
    <tbody>
      {% for compound in compounds %}
        <tr>
          <td>
            {% if compound.variant_obj %}
              <a href='{{url_for("core.variant",
                                 institute_id=institute_id,
                                 case_id=case_id,
                                 variant_id=compound.variant)}}'>
                {{ compound.display_name }}
              </a>
            {% else %}
              {{ compound.display_name }} <small>(not loaded)</small>
            {% endif %}
          </td>
          <td class='text-right'>{{ compound.combined_score }}</td>
          <td class='text-right'>{{ compound.variant_obj.rank_score }}</td>
          <td>{{ compound.variant_obj.region_annotations|join(',') }}</td>
          <td>{{ compound.variant_obj.functional_annotations|join(',') }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endmacro %}

{% macro activity_panel(events) %}
  <div class="panel panel-default">
    <div class="panel-heading">Activity</div>
    <ul class="list-group list-group-scrollable">
      {% for event in events %}
        <li class="list-group-item">
          <strong>{{ event.author.name }}</strong>
          {{ event.display_info }}
          <a href="{{ event.link }}">{{ event.subject }}</a>
          at <span class="timestamp">{{ event.created_at.date() }}</span>
        </li>
      {% else %}
        <li class="list-group-item">No activity yet</li>
      {% endfor %}
    </ul>
  </div>
{% endmacro %}
