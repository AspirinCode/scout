{% extends "core/layout.html" %}

{% block title %}
  {{ super() }} - {{ institute.display_name }} - Panels - {{ panel.display_name }}
{% endblock %}

{% block top_nav %}
  <li>
    <a href="{{ url_for('core.cases', institute_id=institute.internal_id) }}">
      {{ institute.display_name }}
    </a>
  </li>
  <li>
    <a href="{{ url_for('core.case', institute_id=institute.internal_id, case_id=case.display_name) }}">
      {{ case.display_name }}
    </a>
  </li>
  <li class="active">
    <a href="#">{{ panel.display_name }}</a>
  </li>
{% endblock %}

{% block content %}
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-3 col-md-2 sidebar">
        <ul class="nav nav-sidebar">
          <li class="nav-sidebar-heading">
            Panel
            <h4>{{ panel.display_name }}</h4>
          </li>
          {% for gene_panel in case.gene_panels %}
            <li class="{% if gene_panel == panel %}active{% endif %}">
              {{ panel_link(gene_panel) }}
            </li>
          {% endfor %}
        </ul>
      </div>

      <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <div class="panel panel-default">
          <div class="panel-heading">Overview</div>
          <ul class="list-group">
            <li class="list-group-item">
              Full name
              <span class="pull-right">{{ panel.display_name }}</span>
            </li>
            <li class="list-group-item">
              Panel ID
              <span class="pull-right">{{ panel.panel_name }}</span>
            </li>
            <li class="list-group-item">
              Version
              <span class="pull-right">{{ panel.version }}</span>
            </li>
            <li class="list-group-item">
              Number of genes
              <span class="pull-right">{{ panel.gene_objects|length }}</span>
            </li>
            <li class="list-group-item">
              Date
              <span class="pull-right">{{ panel.date.date() }}</span>
            </li>
            <li class="list-group-item">
              Coverage report
              <a class="pull-right" href="#" onclick="document.getElementById('report-form').submit();">
                View
              </a>
              <form id="report-form" action="{{ url_for('report.report', group_id=case.case_id, panel_name=panel.name_and_version, level=institute.coverage_cutoff) }}" method="POST" target="_blank">
                <input type="hidden" name="gene_ids" value="{{ panel.gene_ids|join(',') }}">
              </form>
            </li>
            <li class="list-group-item">
              Coverage overview
              <span class="pull-right">
                <a href="{{ url_for('report.genes', level=institute.coverage_cutoff, sample_id=case.sample_ids, gene_id=panel.genes|join(','), exonlink='core.pileup_range') }}" target="_blank">
                  {{ case.display_name }}
                </a>
              </span>
            </li>
          </ul>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">Included genes (coverage)</div>
          <ul class="list-group">
            {% for gene_id, gene in panel.gene_objects.items() %}
              <li class="list-group-item">
                <a href="{{ url_for('report.gene', gene_id=gene_id, **covlink_kwargs) }}" target="_blank">
                  {{ gene_id }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% macro panel_link(gene_panel) %}
  <a href="{{ url_for('core.gene_panel', institute_id=institute.internal_id, case_id=case.display_name, panel_id=gene_panel.panel_name) }}">
    {{ gene_panel.display_name }}
  </a>
{% endmacro %}
